{% extends "base.html" %}

{% block title %}Dashboard Administrativo{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2"><i class="bi bi-speedometer2"></i> Dashboard Administrativo</h1>
    <div class="text-muted">
        <i class="bi bi-calendar"></i> {{ moment().format('dddd, D [de] MMMM [de] YYYY') if moment else 'Hoy' }}
    </div>
</div>

<!-- Estadísticas principales -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card text-white bg-primary h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <i class="bi bi-people fs-1"></i>
                    <div class="ms-3">
                        <h5 class="card-title mb-1">Total Usuarios</h5>
                        <h3 class="mb-0">{{ stats.total_users }}</h3>
                        <small class="text-light">Registrados en el sistema</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card text-white bg-success h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <i class="bi bi-person-heart fs-1"></i>
                    <div class="ms-3">
                        <h5 class="card-title mb-1">Total Pacientes</h5>
                        <h3 class="mb-0">{{ stats.total_patients }}</h3>
                        <small class="text-light">En base de datos</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card text-white bg-warning h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <i class="bi bi-calendar-check fs-1"></i>
                    <div class="ms-3">
                        <h5 class="card-title mb-1">Citas Hoy</h5>
                        <h3 class="mb-0">{{ today_appointments }}</h3>
                        <small class="text-light">Programadas para hoy</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card text-white bg-info h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <i class="bi bi-hospital fs-1"></i>
                    <div class="ms-3">
                        <h5 class="card-title mb-1">Médicos Activos</h5>
                        <h3 class="mb-0">{{ stats.active_doctors }}</h3>
                        <small class="text-light">Disponibles</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Segunda fila de estadísticas -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card border-primary h-100">
            <div class="card-body text-center">
                <i class="bi bi-person-plus-fill text-primary fs-2"></i>
                <h5 class="card-title mt-2">Enfermeras</h5>
                <h4 class="text-primary">{{ stats.active_nurses }}</h4>
                <small class="text-muted">Activas</small>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card border-success h-100">
            <div class="card-body text-center">
                <i class="bi bi-person-workspace text-success fs-2"></i>
                <h5 class="card-title mt-2">Recepcionistas</h5>
                <h4 class="text-success">{{ stats.active_receptionists }}</h4>
                <small class="text-muted">Activas</small>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card border-warning h-100">
            <div class="card-body text-center">
                <i class="bi bi-heart-pulse text-warning fs-2"></i>
                <h5 class="card-title mt-2">Especialidades</h5>
                <h4 class="text-warning">{{ stats.total_specialties }}</h4>
                <small class="text-muted">Disponibles</small>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card border-info h-100">
            <div class="card-body text-center">
                <i class="bi bi-calendar-event text-info fs-2"></i>
                <h5 class="card-title mt-2">Citas Pendientes</h5>
                <h4 class="text-info">{{ pending_appointments }}</h4>
                <small class="text-muted">Programadas</small>
            </div>
        </div>
    </div>
</div>

<!-- Información mensual y financiera -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header bg-light">
                <h5 class="card-title mb-0">
                    <i class="bi bi-graph-up text-success"></i> Resumen Mensual
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <div class="text-center p-3">
                            <i class="bi bi-check-circle-fill text-success fs-1"></i>
                            <h4 class="text-success mt-2">{{ completed_this_month }}</h4>
                            <small class="text-muted">Citas Completadas</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center p-3">
                            <i class="bi bi-currency-dollar text-success fs-1"></i>
                            <h4 class="text-success mt-2">S/ {{ "%.2f"|format(monthly_revenue) }}</h4>
                            <small class="text-muted">Ingresos del Mes</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header bg-light">
                <h5 class="card-title mb-0">
                    <i class="bi bi-clock text-primary"></i> Citas de Hoy por Estado
                </h5>
            </div>
            <div class="card-body">
                {% if today_appointments_by_status %}
                    {% for status, count in today_appointments_by_status.items() %}
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="badge 
                                {% if status == 'scheduled' %}bg-primary
                                {% elif status == 'completed' %}bg-success
                                {% elif status == 'cancelled' %}bg-danger
                                {% elif status == 'in_triage' %}bg-warning
                                {% elif status == 'ready_for_doctor' %}bg-info
                                {% elif status == 'in_consultation' %}bg-primary
                                {% else %}bg-secondary
                                {% endif %} me-2">
                                {% if status == 'scheduled' %}Programada
                                {% elif status == 'completed' %}Completada
                                {% elif status == 'cancelled' %}Cancelada
                                {% elif status == 'in_triage' %}En Triage
                                {% elif status == 'ready_for_doctor' %}Lista para Doctor
                                {% elif status == 'in_consultation' %}En Consulta
                                {% elif status == 'no_show' %}No Asistió
                                {% else %}{{ status|title }}
                                {% endif %}
                            </span>
                            <strong>{{ count }}</strong>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center text-muted">
                        <i class="bi bi-calendar-x fs-3"></i>
                        <p class="mt-2">No hay citas programadas para hoy</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Información adicional -->
<div class="row">
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header bg-light">
                <h5 class="card-title mb-0">
                    <i class="bi bi-people text-info"></i> Últimos Pacientes Registrados
                </h5>
            </div>
            <div class="card-body">
                {% if recent_patients %}
                    <div class="list-group list-group-flush">
                        {% for patient in recent_patients %}
                            <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <div>
                                    <strong>{{ patient.first_name }} {{ patient.last_name }}</strong>
                                    <br>
                                    <small class="text-muted">{{ patient.dni }}</small>
                                </div>
                                <small class="text-muted">
                                    {{ patient.created_at.strftime('%d/%m/%Y') if patient.created_at }}
                                </small>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center text-muted">
                        <i class="bi bi-person-x fs-3"></i>
                        <p class="mt-2">No hay pacientes registrados recientemente</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header bg-light">
                <h5 class="card-title mb-0">
                    <i class="bi bi-award text-warning"></i> Médicos Más Activos (Este Mes)
                </h5>
            </div>
            <div class="card-body">
                {% if top_doctors %}
                    <div class="list-group list-group-flush">
                        {% for doctor in top_doctors %}
                            <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <div>
                                    <strong>Dr. {{ doctor.first_name }} {{ doctor.last_name }}</strong>
                                </div>
                                <span class="badge bg-primary rounded-pill">{{ doctor.appointment_count }} citas</span>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center text-muted">
                        <i class="bi bi-graph-down fs-3"></i>
                        <p class="mt-2">No hay datos de actividad este mes</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}
