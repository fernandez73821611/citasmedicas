<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket de Consulta - {{ patient.full_name }}</title>
    <style>
        /* Estilos espec√≠ficos para impresi√≥n tipo tiquetera */
        @page {
            size: 80mm auto; /* Ancho t√≠pico de papel de tiquetera */
            margin: 5mm;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.3;
            margin: 0;
            padding: 8px;
            background: white;
            color: black;
            max-width: 70mm;
        }
        
        .ticket-container {
            width: 100%;
            text-align: center;
        }
        
        .clinic-header {
            border-bottom: 2px solid #000;
            padding-bottom: 8px;
            margin-bottom: 10px;
        }
        
        .clinic-name {
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 3px;
        }
        
        .clinic-details {
            font-size: 9px;
            line-height: 1.2;
        }
        
        .logo-placeholder {
            width: 40px;
            height: 40px;
            border: 1px solid #ccc;
            margin: 5px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            color: #666;
        }
        
        .consultation-info {
            margin: 10px 0;
            text-align: left;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
            border-bottom: 1px dotted #ccc;
        }
        
        .info-label {
            font-weight: bold;
            width: 35%;
        }
        
        .info-value {
            width: 65%;
            text-align: right;
        }
        
        .section-header {
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 12px;
            margin-bottom: 5px;
            border-top: 1px solid #000;
            border-bottom: 1px solid #000;
            padding: 3px 0;
            text-align: center;
            font-size: 10px;
        }
        
        .section-content {
            margin-bottom: 8px;
            text-align: left;
            padding: 0 3px;
        }
        
        .footer {
            margin-top: 15px;
            border-top: 2px solid #000;
            padding-top: 8px;
            text-align: center;
            font-size: 9px;
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block;
            }
            
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
        
        .print-button {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            z-index: 1000;
        }
        
        .print-button:hover {
            background-color: #0056b3;
        }
        
        .back-button {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 10px 20px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            z-index: 1000;
            text-decoration: none;
        }
        
        .back-button:hover {
            background-color: #545b62;
            color: white;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <!-- Botones de navegaci√≥n (no se imprimen) -->
    <a href="{{ url_for('doctor.view_consultation', id=consultation.id) }}" class="back-button no-print">
        ‚Üê Volver
    </a>
    <button onclick="window.print()" class="print-button no-print">
        üñ®Ô∏è Imprimir
    </button>

    <div class="ticket-container">
        <!-- Encabezado de la cl√≠nica -->
        <div class="clinic-header">
            <div class="clinic-name">{{ clinic_info.name }}</div>
            <div class="logo-placeholder">LOGO</div>
            <div class="clinic-details">
                {{ clinic_info.address }}<br>
                RUC: {{ clinic_info.ruc }}<br>
                Tel: {{ clinic_info.phone }}<br>
                {{ clinic_info.email }}
            </div>
        </div>

        <!-- Informaci√≥n de la consulta -->
        <div class="consultation-info">
            <div class="info-row">
                <span class="info-label">FECHA:</span>
                <span class="info-value">{{ consultation.consultation_date.strftime('%d/%m/%Y') }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">HORA:</span>
                <span class="info-value">{{ consultation.consultation_date.strftime('%H:%M') }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">DOCTOR:</span>
                <span class="info-value">{{ doctor.full_name }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">ESPECIALIDAD:</span>
                <span class="info-value">{{ doctor.specialty.name if doctor.specialty else 'General' }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">PACIENTE:</span>
                <span class="info-value">{{ patient.full_name }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">DNI:</span>
                <span class="info-value">{{ patient.dni }}</span>
            </div>
        </div>

        <!-- Ex√°menes Auxiliares -->
        {% if consultation.auxiliary_exams and consultation.auxiliary_exams.strip() %}
        <div class="section-header">EX√ÅMENES AUXILIARES</div>
        <div class="section-content">
            {{ consultation.auxiliary_exams|replace('\n', '<br>')|safe }}
        </div>
        {% endif %}

        <!-- Medicamentos Recetados -->
        {% if consultation.prescriptions and consultation.prescriptions.strip() %}
        <div class="section-header">MEDICAMENTOS RECETADOS</div>
        <div class="section-content">
            {{ consultation.prescriptions|replace('\n', '<br>')|safe }}
        </div>
        {% endif %}

        <!-- Indicaciones y Recomendaciones -->
        {% if consultation.recommendations and consultation.recommendations.strip() %}
        <div class="section-header">INDICACIONES Y RECOMENDACIONES</div>
        <div class="section-content">
            {{ consultation.recommendations|replace('\n', '<br>')|safe }}
        </div>
        {% endif %}

        <!-- Informaci√≥n adicional del diagn√≥stico -->
        {% if consultation.diagnosis and consultation.diagnosis.strip() %}
        <div class="section-header">DIAGN√ìSTICO</div>
        <div class="section-content">
            {{ consultation.diagnosis|replace('\n', '<br>')|safe }}
        </div>
        {% endif %}

        <!-- Pr√≥xima cita si existe -->
        {% if consultation.next_appointment_date %}
        <div class="section-header">PR√ìXIMA CITA</div>
        <div class="section-content">
            <strong>{{ consultation.next_appointment_date.strftime('%d/%m/%Y') }}</strong>
        </div>
        {% endif %}

        <!-- Footer -->
        <div class="footer">
            <div>*** RECETA M√âDICA ***</div>
            <div>Ticket generado el {{ now.strftime('%d/%m/%Y %H:%M') }}</div>
            <div style="margin-top: 5px;">
                Conserve este ticket para su pr√≥xima consulta
            </div>
        </div>
    </div>

    <script>
        // Auto-imprimir al cargar la p√°gina (opcional)
        // window.onload = function() {
        //     window.print();
        // };
        
        // Funci√≥n para imprimir y cerrar
        function printAndClose() {
            window.print();
            // Opcional: cerrar ventana despu√©s de imprimir
            // setTimeout(function() {
            //     window.close();
            // }, 1000);
        }
    </script>
</body>
</html>
